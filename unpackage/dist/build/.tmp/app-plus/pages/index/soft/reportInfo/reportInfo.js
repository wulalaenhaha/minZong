(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/soft/reportInfo/reportInfo"],{"04ef":function(t,e,o){},"161c":function(t,e,o){"use strict";var a=o("04ef"),r=o.n(a);r.a},"371c":function(t,e,o){"use strict";o.r(e);var a=o("44b5"),r=o.n(a);for(var n in a)"default"!==n&&function(t){o.d(e,t,function(){return a[t]})}(n);e["default"]=r.a},"44b5":function(t,e,o){"use strict";(function(t,a){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n(o("a34a"));n(o("6092"));function n(t){return t&&t.__esModule?t:{default:t}}function i(t,e,o,a,r,n,i){try{var s=t[n](i),u=s.value}catch(f){return void o(f)}s.done?e(u):Promise.resolve(u).then(a,r)}function s(t){return function(){var e=this,o=arguments;return new Promise(function(a,r){var n=t.apply(e,o);function s(t){i(n,a,r,s,u,"next",t)}function u(t){i(n,a,r,s,u,"throw",t)}s(void 0)})}}var u={data:function(){var t=new Date,e=t.getFullYear(),o=t.getMonth()+1>9?t.getMonth()+1:"0"+(t.getMonth()+1),a=t.getDate()>9?t.getDate():"0"+t.getDate(),r=t.getHours()>9?t.getHours():"0"+t.getHours(),n=t.getMinutes()>9?t.getMinutes():"0"+t.getMinutes();return{index:1,arr:[],today:e+"-"+o+"-"+a+" ",time:r+":"+n,address:"请选择事件发生地点",Remark:"",title:"choose/previewImage",imageList:[],imgUrl:[],ID:0,drr:[],videoSrc:[],upVideoSrc:[],brr:["未发生在场所内"],index1:0,crr:[-1],status:"",title1:"",isShow:!1,progress:"上传中...请勿进行其他操作！",progressShow:!1}},methods:{confirmY:function(){this.isShow=!1},quxiao:function(){this.isShow=!1},delImg:function(t){this.imgUrl.splice(t,1),this.imageList.splice(t,1)},delVideo:function(t){this.videoSrc.splice(t,1);var e=this.imgUrl.indexOf(this.upVideoSrc[t]);this.imgUrl.splice(e,1)},getDate:function(t){var e=t.slice(6,t.length-2),o=new Date(parseInt(e)),a=o.getFullYear()+"-"+(o.getMonth()+1)+"-"+o.getDate();return a},getTime:function(t){var e=t.slice(6,t.length-2),o=new Date(parseInt(e)),a=o.getHours()+":"+o.getMinutes();return a},bindPickerChange:function(t){this.index=t.detail.value},bindPickerChange1:function(e){this.index1=e.detail.value,this.ID=this.crr[this.index1],t("log","ID"+this.ID," at pages\\index\\soft\\reportInfo\\reportInfo.vue:159")},timePickerChange:function(t){this.time=t.detail.value},search:function(){var e=this;a.chooseLocation({keyword:"",success:function(o){t("log",o," at pages\\index\\soft\\reportInfo\\reportInfo.vue:170"),e.address=o.address}})},report:function(e){a.request({url:getApp().globalData.api+"/Report/AddReport",data:{Account:getApp().globalData.userName,Password:getApp().globalData.userPwd,ReligiousInfoID:this.crr[this.index1],EventCategory:this.arr[this.index],InformPlace:this.address,InformTime:this.today+" "+this.time+":00",Remark:this.Remark,AddMan:getApp().globalData.userID,PhotoUrl:this.imgUrl.toString(),Status:e},success:function(o){0==o.data.code?(t("log","成功"," at pages\\index\\soft\\reportInfo\\reportInfo.vue:192"),2==e?a.showToast({title:"暂存成功！",icon:"success",duration:1500,success:function(){setTimeout(function(){a.navigateTo({url:"../soft"})},1600)}}):0==e&&a.showToast({title:"上报成功！",icon:"success",duration:1500,success:function(){setTimeout(function(){a.navigateTo({url:"../soft"})},1600)}})):1==o.data.code?t("log","失败"," at pages\\index\\soft\\reportInfo\\reportInfo.vue:221"):-1==o.data.code&&t("log","用户名或密码错误"," at pages\\index\\soft\\reportInfo\\reportInfo.vue:223")},fail:function(e){t("log",e," at pages\\index\\soft\\reportInfo\\reportInfo.vue:227")}})},update:function(e){t("log","调用更新接口"," at pages\\index\\soft\\reportInfo\\reportInfo.vue:232"),a.request({url:getApp().globalData.api+"/Report/UpdateReport",data:{Account:getApp().globalData.userName,Password:getApp().globalData.userPwd,ID:this.ID,ReligiousInfoID:this.crr[this.index1],EventCategory:this.arr[this.index],InformPlace:this.address,InformTime:this.today+" "+this.time+":00",Remark:this.Remark,PhotoUrl:this.imgUrl.toString(),Status:e},success:function(o){0==o.data.code?(t("log","成功更新"," at pages\\index\\soft\\reportInfo\\reportInfo.vue:249"),2==e?a.showToast({title:"暂存成功！",icon:"success",duration:1500,success:function(){setTimeout(function(){a.navigateTo({url:"../soft"})},1600)}}):0==e&&a.showToast({title:"上报成功！",icon:"success",duration:1500,success:function(){setTimeout(function(){a.navigateTo({url:"../soft"})},1600)}})):1==o.data.code?t("log","失败"," at pages\\index\\soft\\reportInfo\\reportInfo.vue:278"):-1==o.data.code&&t("log","用户名或密码错误"," at pages\\index\\soft\\reportInfo\\reportInfo.vue:280")},fail:function(e){t("log",e," at pages\\index\\soft\\reportInfo\\reportInfo.vue:284")}})},submit:function(){var e=this;e.imgUrl.length>=1?2==e.status?(t("log",e.imgUrl.toString()," at pages\\index\\soft\\reportInfo\\reportInfo.vue:292"),e.update(0)):e.report(0):(e.isShow=!0,e.title1="至少选择一个照片或视频上传！")},cun:function(){2==this.status?this.update(2):this.report(2)},chooseVideo:function(){var e=this,o="";a.chooseVideo({count:1,sourceType:["album","camera"],maxDuration:15,success:function(r){e.videoSrc.push(r.tempFilePath),t("log","得到视频地址，开始传输"," at pages\\index\\soft\\reportInfo\\reportInfo.vue:318");var n=r.tempFilePath,i=a.uploadFile({url:getApp().globalData.api+"/Check/UploadFile",filePath:n,name:"file",success:function(a){var r=JSON.parse(a.data);e.upVideoSrc.push(r.data),t("log","上传成功320"," at pages\\index\\soft\\reportInfo\\reportInfo.vue:327"),o=r.data,e.imgUrl.push(r.data),e.imgUrl.length>=4&&(e.imgUrl.length=4)},fail:function(o){t("log","传输shibai"," at pages\\index\\soft\\reportInfo\\reportInfo.vue:335"),e.isShow=!0,e.title1="传输失败，请重新上传！",t("log",o," at pages\\index\\soft\\reportInfo\\reportInfo.vue:338")}});i.onProgressUpdate(function(t){e.progressShow=!0,t.progress>=100&&""!=o&&(e.progress="上传成功！",setTimeout(function(){e.progressShow=!1},1e3))})}})},chooseImage:function(){var t=s(r.default.mark(function t(){var e,o=this;return r.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e=4-this.imgUrl.length,a.chooseImage({sourceType:["album","camera"],sizeType:["original","compressed"],count:e,success:function(t){o.imageList=o.imageList.concat(t.tempFilePaths),o.imageList.length>=4&&(o.imageList.length=4);var e=o,r=t.tempFilePaths;r.forEach(function(t,o){a.uploadFile({url:getApp().globalData.api+"/Check/UploadFile",filePath:t,name:"img",formData:{user:"test"},success:function(t){e.imgUrl.push(JSON.parse(t.data).data),e.imgUrl.length>=4&&(e.imgUrl.length=4)}})})},fail:function(t){t["code"]&&t.code}});case 2:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),previewImage:function(t){var e=t.target.dataset.src;a.previewImage({current:e,urls:this.imageList})},prew:function(t){a.navigateTo({url:"./video?src="+t})},choose:function(){var e=this;4==e.imgUrl.length?a.showToast({title:"最多可以上传4张图片或视频！",icon:"none",duration:1500}):a.showActionSheet({itemList:["拍摄视频","相册或拍照"],success:function(o){0==o.tapIndex?(t("log","拍摄视频"," at pages\\index\\soft\\reportInfo\\reportInfo.vue:422"),e.chooseVideo()):1==o.tapIndex&&e.chooseImage()},fail:function(e){t("log",e.errMsg," at pages\\index\\soft\\reportInfo\\reportInfo.vue:429")}})}},onLoad:function(e){this.ID=e.ID,this.status=e.Status,this.arr=[],this.drr=[];var o=this;a.request({url:getApp().globalData.api+"/Religious/ReligiousList",data:{Account:getApp().globalData.userName,Password:getApp().globalData.userPwd,StreetID:-1,ReligName:"",PageNum:0,PageSize:100},success:function(e){if(0==e.data.code){t("log","成功获得场所信息"," at pages\\index\\soft\\reportInfo\\reportInfo.vue:454");for(var a=0;a<e.data.data.length;a++)o.crr.push(e.data.data[a].ID),o.brr.push(e.data.data[a].ReligName)}else 1==e.data.code?t("log","失败"," at pages\\index\\soft\\reportInfo\\reportInfo.vue:460"):-1==e.data.code&&t("log","用户名或密码错误"," at pages\\index\\soft\\reportInfo\\reportInfo.vue:462")},fail:function(e){t("log",e," at pages\\index\\soft\\reportInfo\\reportInfo.vue:466")}}),a.request({url:getApp().globalData.api+"/Report/GetReportEventList",data:{Account:getApp().globalData.userName,Password:getApp().globalData.userPwd},success:function(e){if(0==e.data.code){t("log","成功收到事件分类"," at pages\\index\\soft\\reportInfo\\reportInfo.vue:477");for(var a=0;a<e.data.data.length;a++)o.drr.push(e.data.data[a].ID),o.arr.push(e.data.data[a].ItemName)}else 1==e.data.code?t("log","失败收到事件分类"," at pages\\index\\soft\\reportInfo\\reportInfo.vue:483"):-1==e.data.code&&t("log","用户名或密码错误"," at pages\\index\\soft\\reportInfo\\reportInfo.vue:485")},fail:function(e){t("log",e," at pages\\index\\soft\\reportInfo\\reportInfo.vue:489")}})},mounted:function(){var e=this;a.request({url:getApp().globalData.api+"/Report/GetReportDetatil",data:{Account:getApp().globalData.userName,Password:getApp().globalData.userPwd,ID:this.ID},success:function(o){if(0==o.data.code){if(t("log","成功11"," at pages\\index\\soft\\reportInfo\\reportInfo.vue:504"),e.index=e.arr.indexOf(o.data.data[0].EventCategory),e.index1=e.crr.indexOf(o.data.data[0].ReligiousInfoID),e.address=o.data.data[0].InformPlace,e.Remark=o.data.data[0].Remark,e.today=e.getDate(o.data.data[0].AddTime),e.time=e.getTime(o.data.data[0].AddTime).slice(0,5),null!=o.data.data[0].PhotoUrl){for(var a=o.data.data[0].PhotoUrl.split(","),r=0;r<a.length;r++){e.imgUrl[r]=a[r];var n=a[r].indexOf("mp4");a[r]=getApp().globalData.imgUrl+a[r],-1==n?e.imageList.push(a[r]):e.videoSrc.push(a[r])}t("log",e.imgUrl," at pages\\index\\soft\\reportInfo\\reportInfo.vue:523")}}else 1==o.data.code?t("log","失败1"," at pages\\index\\soft\\reportInfo\\reportInfo.vue:526"):-1==o.data.code&&t("log","用户名或密码错误"," at pages\\index\\soft\\reportInfo\\reportInfo.vue:528")},fail:function(e){t("log",e," at pages\\index\\soft\\reportInfo\\reportInfo.vue:532")}})}};e.default=u}).call(this,o("0de9")["default"],o("6e42")["default"])},"7d1d":function(t,e,o){"use strict";var a,r=function(){var t=this,e=t.$createElement;t._self._c},n=[];o.d(e,"b",function(){return r}),o.d(e,"c",function(){return n}),o.d(e,"a",function(){return a})},bfc7:function(t,e,o){"use strict";o.r(e);var a=o("7d1d"),r=o("371c");for(var n in r)"default"!==n&&function(t){o.d(e,t,function(){return r[t]})}(n);o("161c");var i,s=o("f0c5"),u=Object(s["a"])(r["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],i);e["default"]=u.exports},e4fd:function(t,e,o){"use strict";(function(t){o("a8ab"),o("921b");a(o("66fd"));var e=a(o("bfc7"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("6e42")["createPage"])}},[["e4fd","common/runtime","common/vendor"]]]);